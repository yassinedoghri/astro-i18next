---
import i18next from "i18next";
import ISO6391, { LanguageCode } from "iso-639-1";
import countryCodeToFlagEmoji from "country-code-to-flag-emoji";
import { localizePath } from "../utils";

export interface Props {
  showFlag?: boolean;
}

const supportedLanguages = i18next.languages;
const currentLanguage = i18next.language;

const { pathname } = Astro.canonicalURL;

const { showFlag = false, ...attributes } = Astro.props;
---

<select onchange="location = this.value;" {...attributes}>
  {supportedLanguages.map((supportedLanguage: string) => {
    let value = localizePath(pathname, supportedLanguage)
    const label = `${
      showFlag ? countryCodeToFlagEmoji(supportedLanguage) + " " : ""
    }${ISO6391.getNativeName(supportedLanguage as LanguageCode)}`

    return (
      <option value={value} selected={supportedLanguage === currentLanguage}>
        {label}
      </option>
    )
  })}
</select>
